RepoMan
=======

GoUpdate's RepoMan (short for Repository Manager) tool is used to manage GoUpdate repositories. It can:

+ Create repositories.
+ Update repositories.
+ Manage channels.

This document outlines each feature and how it works internally. Please note that RepoMan is speciallized for MultiMC's use case. Generating GoUpdate repositories is complicated, if you really want a tool that does exactly what you want, the best option may be to write it yourself.


Basic Repository Operations
===========================

Repositories generated by RepoMan have two directories: the repository directory and the file directory. The repository directory is the directory where RepoMan will put the repository info files such as the index and the version and channel info files. The file directory is where RepoMan will link the source objects in each version to. Both of these directories should be served by a webserver at a location given to RepoMan.

RepoMan requires the following information in order to generate and update repositories.

+ The path to the repository directory.
+ The path to the update files directory. 
+ The "base" URL to generate HTTP (and HTTPC) sources from.
+ The path to the directory with the files for the new version of the application.
+ The version ID and the version name of the latest version.


Creating a Repository
=====================

When creating a new repository, RepoMan will first create a blank index file in the repository directory and then run the update repository process (see "Updating a Repository" below).


Updating a Repository
=====================

When updating a repository, RepoMan will do the following.

1. Load the existing repository's index file and check what the latest version is.
2. Load the JSON file for the newest version in that repository.
3. Calculate the MD5 sum of all of the new version's files.
4. Determine whether or not each of the new update's files are the same (have the same MD5 sum) as the corresponding files in repository's latest version.
5. Copy any of the new version's files that aren't the same as the previous latest version's files to `<update files directory>/<version ID>/<filename>`.
6. Generate the new version JSON file. For any files which haven't changed since the last version, point their HTTP source's URL to the same URL as their corresponding files in the previous version.


File Storage Directory
----------------------

To save disk space, RepoMan will try to re-use any files in the file storage directory that are the same as any of the files in the latest update. If there are already matching files in the file storage, RepoMan will point the HTTP source for their corresponding files in the latest update to those that are already in file storage instead of copying additional files to storage. To do this, RepoMan will keep a file in the file storage directory to keep track of the MD5 sums of all the files in the file storage directory. Whenever it updates the repository, RepoMan will go through all the files in the file storage directory and calculate the MD5 sum for any files that aren't listed in the MD5 cache.

